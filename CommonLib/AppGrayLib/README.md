# App置灰方案实践库
#### 目录介绍
- 01.基础概念介绍
- 02.常见思路和做法
- 03.Api调用说明
- 04.原理深度分析
- 05.其他问题说明



### 01.基础概念说明
#### 1.1 背景说明
- 当在特殊的某一个日子
    - 我们会表达我们的悼念，缅怀、纪念之情，APP会在某一日设置成黑灰色。比如清明节这天很多App都设置了符合主题的灰色模式。
  


#### 1.2 设计目标



### 02.常见思路和做法
#### 2.1 设置灰色核心
- 实现思路分析说明
    - 实现灰度化的思路应该从 Android 系统界面绘制原理出发寻找实现方案。系统是通过 Paint 将内容绘制到界面上的，Paint 中可以设置 ColorMatrix ，界面置灰可以通过通过使用颜色矩阵（ColorMatrix）来实现。
- 创建灰色模式的核心代码
    - setSaturation方法用于设置矩阵以影响颜色的饱和度，即0为灰色，1为彩色。


#### 2.2 实现方案探讨
- 实现方案探讨有哪些？
    - 第一种：给Activity的顶层View设置置灰，实现全局置灰效果。这样就可以实现啦，这种方式还是比较简单的。
    - 第二种：该方法使用自定义layout，在dispatchDraw方法的时候，添加一层黑白色的bitmap，让界面开起来成为黑白模式。
    - 第三种：除了给Activity外，有些特殊控件需要置灰，比如webView、H5页面、视频等。使用View设置灰色！
    - 第四种：设置两套不同的资源文件，根据全局置灰开关，选择加载不同的图片和色值。
- 这些方式优缺点分析
    - 第一种：DecorView 是 Activity 窗口的根视图，根视图通过 ColorMatrix 设置置灰应该可以在全部子元素有效。需要用到BaseActivity中。
    - 第二种：其本质还是属于自定义View，实现灰色本质都是使用 Paint 进行的绘制，使用起来稍微麻烦一些。
    - 第三种：不仅支持Activity，还可以支持其他各种View设置灰色，相当于第一种方案的加强版本。
    - 第四种：实现起来工作繁琐、工作量大。且会导致 App 包增大很多，用户体验差。



#### 2.3 如何控制设置开关
- 设置灰色的开关该怎么做呢？
    - 第一种方式：把网络请求的接口放在了欢迎页中进行
    - 第二种方式：配置AB测试开关
- 这些方式优缺点分析
    - 第一种分析：只获取一个值，耗时并不会特别严重，并不影响用户的体验，受到网络环境影响。
    - 第二种分析：相比于接库，配置起来简单，也方便开发，产品配置开关。


### 03.Api调用说明
- Api调用如下所示
    ``` java
    AppGrayHelper.getInstance().setType(1).setGray(true).setGrayApp(this);
    ```


### 04.原理深度分析
#### 4.1 颜色矩阵说明
- 颜色矩阵是什么东西？
    - 在 Android 中，系统使用一个颜色矩阵 ColorMatrix，来处理图像的色彩效果。通过这个类，可以很方便地改变矩阵值来处理颜色效果。
- ColorMatrix 提供了以下关键方法进行对颜色的处理：
    - setRotate(int axis, float degree) ：设置颜色的色调，第一个参数，系统分别使用0、1、2 来代表 Red、Green、Blue 三种颜色的处理；而第二个参数，就是需要处理的值。
    - setSaturation(float sat)：设置颜色的饱和度，参数代表设置颜色饱和度的值，当饱和度为0时，图像就变成灰度图像。
    - setScale(float rScale, float gScale, float bScale , float aScale)：对于亮度进行处理。
- setSaturation 方法
    - 设置颜色矩阵的饱和度，0 是灰色的，1 是原图。通过调用 setSaturation (0) 方法即可将图像置为灰色 。



### 05.其他问题说明




- 如何用10行代码让app全局置灰
    - https://juejin.cn/post/6844904117110833165
- Android实现设置灰白模式效果
    - https://cloud.tencent.com/developer/article/1921134

