# Android应用窗口
#### 目录介绍
- 01.Android组件UI实现
    - 1.1 组件的UI实现介绍
    - 1.2 Activity组件类关系
    - 1.3 Window类的实现
    - 1.4 


### 01.Android组件UI实现
#### 1.1 组件的UI实现介绍
- Activity组件的UI实现需要与WindowManagerService服务和SurfaceFlinger服务进行交互。
    - Activity组件在启动完成后，会通过一个类型为Session的Binder对象来请求WindowManagerService为它创建一个类型为WindowState的对象，用来描述它的窗口状态。
    - Android应用程序会通过一个类型为Client的Binder对象来请求SurfaceFlinger服务为它创建一个类型为Layer的对象，用来描述它的窗口数据。
- Activity组件与WindowManagerService服务和SurfaceFlinger服务的交互模型
    - ![image](https://img-blog.csdnimg.cn/15f1dd26c6604b2086fbc5709e8ad913.png)



#### 1.2 Activity组件类关系
- Activity组件的类关系图
    - ![image](https://img-blog.csdnimg.cn/6d7a25acd0d44157b2d177fb3616ec53.png)
- Activity类与Context关系
    - Activity类是从ContextThemeWrapper类继承下来的，而ContextThemeWrapper类又是从ContextWrapper类继承下来的，最后ContextWrapper类又继承了Context类。
    - 这个ContextImpl对象首先是通过调用Activity类的成员函数attach传递到Activity组件内部，接着再依次通过调用父类ContextThemeWrapper和ContextWrapper的成员函数attachBaseContext来分别保存在它们的成员变量mBase中。
    - 因此，ContextThemeWrapper和ContextWrapper类的成员变量mBase指向的实际上是一个ContextImpl对象。
- Activity启动是如何和Context交互的
    > ActivityThread#performLaunchActivity()，创建Activity类型上下文Context然后创建activity对象
    > ActivityThread#createBaseContextForActivity()，通过ContextImpl静态方法创建该对象
    > ContextImpl#createActivityContext()，通过new去新建一个ContextImpl对象，并且做初始化配置操作


#### 1.3 Window类的实现
- Activity组件创建一个PhoneWindow
    - ![image](https://img-blog.csdnimg.cn/6aedf6d232f04dee8012e8ff07ee8194.png)
- PhoneWindow创建过程
    > ActivityThread#performLaunchActivity()，通过反射的机制创建的Activity，并调用了Activity的attach方法
    > Activity#attach()，在attach方法这里初始化了一些Activity的成员变量，最重要是创建PhoneWindow对象
- PhoneWindow类的实现说明
    - PhoneWindow类有两个重要的成员变量mDecor和mContentParent，它们的类型分别DecorView和ViewGroup。
    - 其中，成员变量mDecor是用描述自己的窗口视图，而成员变量mContentParent用来描述视图内容的父窗口。
- DecorView类继承了FrameLayout类
    - DecorView类继承了FrameLayout类，而FrameLayout类又继承了ViewGroup类，最后ViewGroup类又继承了View类。View类有一个成员函数draw，它是用来绘制应用程序窗口的UI的。
    - DecorView类、FrameLayout类和ViewGroup类都重写了父类的成员函数draw，这样，它们就都可以定制自己的UI。






