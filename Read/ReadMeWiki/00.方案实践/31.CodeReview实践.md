# CodeReview实践总结
#### 目录介绍
- 01.为何要CR机制
    - 1.1 CR机制的背景
    - 1.2 CR机制的目的
    - 1.3 CR时机
    - 1.4 Review串讲
- 02.Git配置CR实践
    - 2.1 搭建Git配置CR
    - 2.2 CR提交实践
    - 2.3 CR如何打退
    - 2.4 CR通过说明
    - 2.5 高效CR实践
- 03.CodeReview清单
    - 3.1 普通常规项
    - 3.2 代码安全项
    - 3.3 无效沉余项
    - 3.4 文档注释项
    - 3.5 一些其他细节
- 04.CodeReview实践
    - 4.1 CodeReview方式
    - 4.2 CodeReview输出
    - 4.3 CR注意事项说明
    - 4.4 CR标准模版说明
- 05.代码如何自查
    - 5.1 对比新老代码
    - 5.2 Studio工具检查



### 01.为何要CR机制
#### 1.1 CR机制的背景
- 修改代码导致不可控
    - 修改代码所带来的bug比新开发功能的bug并不会少，因为测试人员并不完全知道你所修改的部分到底影响到了哪些子功能或者哪些其它的模块。
- 大需求设计存在不合理
    - 针对比较大的业务需求，尤其前期时间比较紧，开发业务想着先是实现功能。而忽略了整体架构的设计，分层，导致业务后期迭代越来越难。
- CodeReview的背景
    - 通过CR对每一个小的改动追根究底的询问和跟踪，能够发现测试无法发现的一些隐藏的诡异的问题，大家相互CR还能快速熟悉业务。
- Google的CR机制
    - 在Google，任何产品，任何工程的代码，在被进行严格或者明确的审查（code review）之前，是不允许提交的。
    - CR是严格的软件开发中一个通用的规则。不仅仅是产品代码这样——而应该是一切。它不会占用特别多的工作时间，但是会带来巨大的不同。


#### 1.2 CR机制的目的
- 通过code Review的代码可以上升到更高的层次。
    - 1、提升开发人员代码编写质量
    - 2、现有版本的优化
    - 3、开发人员间代码和业务互相熟悉


#### 1.3 CR时机



#### 1.4 Review串讲


### 02.Git配置CR实践
#### 2.1 搭建Git配置CR


#### 2.2 CR提交实践
- Gitlab提供了两种代码merge机制：
    - 第一种：在本地将源分支(Source branch)代码合并到目标分支（Target branch），然后Push到目标分支（Target branch）
    - 第二种：将源分支(Source branch)Push到远端，然后在GitLab指定目标分支（Target branch）发起Merge Request，对目标分支（Target branch）拥有merge权限的用户执行Merge操作，完成合并。
- 那种方式提交才能CR操作
    - 第二种适合CodeReview，发起MR后，由有Merge权限用户做CodeReview，通过后执行merge操作。
- CommitMessage规范如下
    - 应该尽量清晰明了，说明本次提交的目的。说明commit的类别，常用的标识如下：
    ``` java
    feat：新功能
    fix：修补bug
    docs：文档
    style： 格式（不影响代码运行的变动,空格,格式化,等等）
    refactor：重构（即不是新增功能，也不是修改bug的代码变动)
    perf: 性能 (提高代码性能的改变)
    test：增加测试或者修改测试
    build: 影响构建系统或外部依赖项的更改(maven,gradle,npm 等等)
    ci: 对CI配置文件和脚本的更改
    chore：对非 src 和 test 目录的修改
    revert: Revert a commit
    ```


#### 2.3 CR如何打退


#### 2.4 CR通过说明



### 03.CodeReview清单
#### 3.1 普通常规项
- 关于功能上检查
    - 有没有实现预期的功能，逻辑是否正确。
    - 循环是否设置了长度和正确的终止条件？
    - 是否有可以被库函数替代的代码？
    - 是否有可以删除的日志或调试代码？尤其是一些debug代码不能带到线上的
- 关于代码规范检查
    - 代码符合你所遵循的编程规范么？这通常包括大括号的位置，变量名和函数名，行的长度，缩进，格式和注释。
    - 是否存在多余的或是重复的代码？重复的代码是否有抽取？
    - 代码是否尽可能的模块化了？
    - 是否有可以被替换的全局变量？是否有被注释掉的代码？针对常量，是否有注释？


#### 3.2 代码安全项
- 关于代码逻辑安全检查
    - 所有的数据输入是否都进行了检查（检测正确的类型，长度，格式和范围）并且进行了编码？
    - 无效的参数值是否能够处理？
    - 针对if else代码，最后是否处理else分支逻辑？针对递归是否有出口？
    - 输出的值是否进行了检查并且编码？
- 关于代码异常检查
    - 在哪里使用了第三方工具，返回的错误是否被捕获？
    - 针对try-catch操作，为何要这么做？对业务或者功能有何影响？





#### 3.3 无效沉余项



#### 3.4 文档注释项
- 三方库需要有文档
    - 第三方库的使用和函数是否有文档？如果是沉淀lib，则需要完善demo和api调用文档！
- 关于代码注释检查
    - 是否有注释，并且描述了代码的意图？所有的函数都有注释吗？
    - 对非常规行为和边界情况处理是否有描述？
    - 数据结构和计量单位是否进行了解释？
    - 是否有未完成的代码？如果是的话，是不是应该移除，或者用合适的标记进行标记比如‘TODO’？



#### 3.5 一些其他细节
- 未使用 import；
- 未使用的资源，例如 drawables, strings, colors……
- 注释代码；
- 未格式化的代码；
- 变量名、方法名、文件名……


### 04.CodeReview实践
#### 4.1 CodeReview方式
- 第一点：抓重点，比如设计、架构、可读、健壮。
- 第二点：所有人参与codeReview
    - 简单点：技术经理可以从这周提交的代码中找出典型的代码片段，拿出来进行讲解和讨论；
    - 完善点：每个开发者互相codeReview，找出有问题的代码片段，拿来给大家进行讨论。
    - 灵活点：遇到问题就可以跟开发人员面对面沟通。



#### 4.2 CodeReview输出
- 输出成实例规范
    - CodeReview后，发现开发人员比较好的实现方式和思路，可以总结成开发规范，最好能加上实例，这样方便记录和开发人员的规范统一，做到代码的实现看上去是一个人写的。
  


#### 4.3 CR注意事项说明


#### 4.4 CR标准模版说明


### 05.代码如何自查
#### 5.1 对比新老代码


#### 5.2 Studio工具检查
- 执行Android studio –> Analyze –> Inspect code操作之后，所有的lint警告列表就会出来。于是得到六大类Android Lint
    - Correctness 正确性
    - Internationalization 国际化，如字符缺少翻译等问题。
    - Performance 性能，例如在 onMeasure、onDraw 中执行 new，内存泄露，产生了冗余的资源，xml 结构冗余等。
    - Security 安全性，例如没有使用 HTTPS 连接 Gradle，AndroidManifest 中的权限问题等。
    - Usability 易用性，例如缺少某些倍数的切图，重复图标等。
    - Accessibility 无障碍例如 ImageView 缺少contentDescription 描述，String 编码字符串等问题。



### Android CR 案例集 & 最佳实践
- https://cloud.tencent.com/developer/article/1759490
- https://www.jianshu.com/p/859b48f68aed
- https://blog.csdn.net/ddnosh/article/details/79070557


- GITLAB配置CODE REVIEW(两种实现方式)
    - https://www.freesion.com/article/17541170322/
- 如何基于GitLab做代码评审
    - https://www.abcxlab.com/blog/202004132352405063.html
























